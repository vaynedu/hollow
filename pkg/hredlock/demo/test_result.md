# 秒杀第一版，分段库存+分布式锁， 测试结果如下
目前存在问题，
- 分段库存消耗不均匀
$ go run seckill_stock.go 
2025/07/20 10:56:02 用户 user_46 秒杀成功
2025/07/20 10:56:02 用户 user_56 秒杀成功
2025/07/20 10:56:02 用户 user_43 秒杀成功
2025/07/20 10:56:02 用户 user_10 秒杀成功
2025/07/20 10:56:02 用户 user_74 秒杀成功
2025/07/20 10:56:02 用户 user_87 秒杀成功
2025/07/20 10:56:02 用户 user_8 秒杀成功
2025/07/20 10:56:02 用户 user_26 秒杀成功
2025/07/20 10:56:02 用户 user_66 秒杀成功
2025/07/20 10:56:02 用户 user_76 秒杀成功
2025/07/20 10:56:02 用户 user_97 秒杀成功
2025/07/20 10:56:02 用户 user_54 秒杀成功
2025/07/20 10:56:02 用户 user_32 秒杀成功
2025/07/20 10:56:02 用户 user_81 秒杀成功
2025/07/20 10:56:02 用户 user_96 秒杀成功
2025/07/20 10:56:02 用户 user_39 秒杀成功
2025/07/20 10:56:02 用户 user_86 秒杀成功
2025/07/20 10:56:02 用户 user_1 秒杀成功
2025/07/20 10:56:02 用户 user_78 秒杀成功
2025/07/20 10:56:02 用户 user_24 秒杀成功
2025/07/20 10:56:02 用户 user_34 秒杀成功
2025/07/20 10:56:02 用户 user_22 秒杀成功
2025/07/20 10:56:02 用户 user_70 秒杀成功
2025/07/20 10:56:02 用户 user_85 秒杀成功
2025/07/20 10:56:02 用户 user_6 秒杀成功
2025/07/20 10:56:02 用户 user_88 秒杀成功
2025/07/20 10:56:02 用户 user_72 秒杀成功
2025/07/20 10:56:02 用户 user_30 秒杀成功
2025/07/20 10:56:02 用户 user_79 秒杀成功
2025/07/20 10:56:02 用户 user_37 秒杀成功
2025/07/20 10:56:02 用户 user_69 秒杀成功
2025/07/20 10:56:02 用户 user_50 秒杀成功
2025/07/20 10:56:02 用户 user_51 秒杀成功
2025/07/20 10:56:02 用户 user_9 秒杀成功
2025/07/20 10:56:02 用户 user_47 秒杀成功
2025/07/20 10:56:02 用户 user_40 秒杀成功
2025/07/20 10:56:02 用户 user_55 秒杀成功
2025/07/20 10:56:02 用户 user_41 秒杀成功
2025/07/20 10:56:02 用户 user_12 秒杀成功
2025/07/20 10:56:02 用户 user_83 秒杀成功
2025/07/20 10:56:02 用户 user_91 秒杀成功
2025/07/20 10:56:02 用户 user_73 秒杀成功
2025/07/20 10:56:02 用户 user_27 秒杀成功
2025/07/20 10:56:02 用户 user_53 秒杀成功
2025/07/20 10:56:02 用户 user_35 秒杀成功
2025/07/20 10:56:02 用户 user_64 秒杀成功
2025/07/20 10:56:02 用户 user_75 秒杀成功
2025/07/20 10:56:02 用户 user_31 秒杀成功
2025/07/20 10:56:02 用户 user_49 秒杀成功
2025/07/20 10:56:02 用户 user_45 秒杀成功
2025/07/20 10:56:02 用户 user_48 秒杀成功
2025/07/20 10:56:02 用户 user_52 秒杀成功
2025/07/20 10:56:02 用户 user_18 秒杀成功
2025/07/20 10:56:02 用户 user_33 秒杀成功
2025/07/20 10:56:02 用户 user_42 秒杀成功
2025/07/20 10:56:02 用户 user_25 秒杀成功
2025/07/20 10:56:02 用户 user_98 秒杀成功
2025/07/20 10:56:03 用户 user_77 秒杀成功
2025/07/20 10:56:03 用户 user_67 秒杀成功
2025/07/20 10:56:03 用户 user_80 秒杀成功
2025/07/20 10:56:03 用户 user_29 秒杀成功
2025/07/20 10:56:03 用户 user_95 秒杀成功
2025/07/20 10:56:03 用户 user_23 秒杀成功
2025/07/20 10:56:03 用户 user_4 秒杀成功
2025/07/20 10:56:03 用户 user_58 秒杀成功
2025/07/20 10:56:03 用户 user_71 秒杀成功
2025/07/20 10:56:03 用户 user_62 秒杀成功
2025/07/20 10:56:03 用户 user_44 秒杀失败（库存不足）, segmentKey: stock_segment_2, stock: 0
2025/07/20 10:56:03 用户 user_92 秒杀成功
2025/07/20 10:56:03 用户 user_21 秒杀成功
2025/07/20 10:56:03 用户 user_11 秒杀成功
2025/07/20 10:56:03 用户 user_44 秒杀失败（库存不足）
2025/07/20 10:56:03 用户 user_5 秒杀成功
2025/07/20 10:56:03 用户 user_20 秒杀失败（库存不足）, segmentKey: stock_segment_2, stock: 0
2025/07/20 10:56:03 用户 user_20 秒杀失败（库存不足）
2025/07/20 10:56:03 用户 user_59 秒杀成功
2025/07/20 10:56:03 用户 user_100 秒杀成功
2025/07/20 10:56:03 用户 user_7 秒杀成功
2025/07/20 10:56:03 用户 user_15 秒杀成功
2025/07/20 10:56:03 用户 user_84 秒杀失败（库存不足）, segmentKey: stock_segment_2, stock: 0
2025/07/20 10:56:03 用户 user_84 秒杀失败（库存不足）
2025/07/20 10:56:03 用户 user_16 秒杀成功
2025/07/20 10:56:03 用户 user_89 秒杀成功
2025/07/20 10:56:03 用户 user_94 秒杀成功
2025/07/20 10:56:03 用户 user_60 秒杀失败（库存不足）, segmentKey: stock_segment_2, stock: 0
2025/07/20 10:56:03 用户 user_60 秒杀失败（库存不足）
2025/07/20 10:56:03 用户 user_82 秒杀失败（库存不足）, segmentKey: stock_segment_10, stock: 0
2025/07/20 10:56:03 用户 user_36 秒杀成功
2025/07/20 10:56:03 用户 user_82 秒杀失败（库存不足）
2025/07/20 10:56:03 用户 user_65 秒杀失败（库存不足）, segmentKey: stock_segment_2, stock: 0
2025/07/20 10:56:03 用户 user_19 秒杀失败（库存不足）, segmentKey: stock_segment_5, stock: 0
2025/07/20 10:56:03 用户 user_90 秒杀成功
2025/07/20 10:56:03 用户 user_65 秒杀失败（库存不足）
2025/07/20 10:56:03 用户 user_19 秒杀失败（库存不足）
2025/07/20 10:56:03 用户 user_2 秒杀成功
2025/07/20 10:56:03 用户 user_13 秒杀成功
2025/07/20 10:56:03 用户 user_3 秒杀失败（库存不足）, segmentKey: stock_segment_5, stock: 0
2025/07/20 10:56:03 用户 user_3 秒杀失败（库存不足）
2025/07/20 10:56:03 用户 user_14 秒杀失败（库存不足）, segmentKey: stock_segment_5, stock: 0
2025/07/20 10:56:03 用户 user_14 秒杀失败（库存不足）
2025/07/20 10:56:03 用户 user_28 秒杀成功
2025/07/20 10:56:03 用户 user_17 秒杀成功
2025/07/20 10:56:03 用户 user_57 秒杀成功
2025/07/20 10:56:03 用户 user_63 秒杀失败（库存不足）, segmentKey: stock_segment_3, stock: 0
2025/07/20 10:56:03 用户 user_63 秒杀失败（库存不足）
2025/07/20 10:56:03 用户 user_99 秒杀成功
2025/07/20 10:56:03 用户 user_68 秒杀成功
2025/07/20 10:56:03 用户 user_61 秒杀失败（库存不足）, segmentKey: stock_segment_2, stock: 0
2025/07/20 10:56:03 用户 user_14 秒杀失败（库存不足）
2025/07/20 10:56:03 用户 user_28 秒杀成功
2025/07/20 10:56:03 用户 user_17 秒杀成功
2025/07/20 10:56:03 用户 user_57 秒杀成功
2025/07/20 10:56:03 用户 user_14 秒杀失败（库存不足）
2025/07/20 10:56:03 用户 user_14 秒杀失败（库存不足）
2025/07/20 10:56:03 用户 user_28 秒杀成功
2025/07/20 10:56:03 用户 user_17 秒杀成功
2025/07/20 10:56:03 用户 user_57 秒杀成功
2025/07/20 10:56:03 用户 user_63 秒杀失败（库存不足）, segmentKey: stock_segment_3, stock: 0
2025/07/20 10:56:03 用户 user_63 秒杀失败（库存不足）
2025/07/20 10:56:03 用户 user_99 秒杀成功
2025/07/20 10:56:03 用户 user_68 秒杀成功
2025/07/20 10:56:03 用户 user_61 秒杀失败（库存不足）, segmentKey: stock_segment_2, stock: 0
2025/07/20 10:56:03 用户 user_61 秒杀失败（库存不足）
2025/07/20 10:56:03 用户 user_38 秒杀成功
2025/07/20 10:56:03 用户 user_93 秒杀失败（库存不足）, segmentKey: stock_segment_2, stock: 0
2025/07/20 10:56:03 用户 user_93 秒杀失败（库存不足）
2025/07/20 10:56:03 秒杀结果: 成功 88 次, 失败 12 次
2025/07/20 10:56:03 剩余总库存: 12


# 分段库存动态调整，这里还会存在热点不均的情况，同一个用户可能会分配到同一个段中
$ go run seckill_stock.go 
2025/07/20 11:34:21 用户 user_74 秒杀成功
2025/07/20 11:34:21 用户 user_75 秒杀成功
2025/07/20 11:34:21 用户 user_2 秒杀成功
2025/07/20 11:34:21 用户 user_78 秒杀成功
2025/07/20 11:34:21 用户 user_9 秒杀成功
2025/07/20 11:34:21 用户 user_48 秒杀成功
2025/07/20 11:34:21 用户 user_45 秒杀成功
2025/07/20 11:34:21 用户 user_98 秒杀成功
2025/07/20 11:34:21 用户 user_100 秒杀成功
2025/07/20 11:34:21 用户 user_56 秒杀成功
2025/07/20 11:34:21 用户 user_96 秒杀成功
2025/07/20 11:34:21 用户 user_39 秒杀成功
2025/07/20 11:34:21 用户 user_87 秒杀成功
2025/07/20 11:34:21 用户 user_95 秒杀成功
2025/07/20 11:34:21 用户 user_3 秒杀成功
2025/07/20 11:34:21 用户 user_28 秒杀成功
2025/07/20 11:34:21 用户 user_42 秒杀成功
2025/07/20 11:34:21 用户 user_64 秒杀成功
2025/07/20 11:34:21 用户 user_70 秒杀成功
2025/07/20 11:34:21 用户 user_99 秒杀成功
2025/07/20 11:34:21 用户 user_53 秒杀成功
2025/07/20 11:34:21 用户 user_61 秒杀成功
2025/07/20 11:34:21 用户 user_5 秒杀成功
2025/07/20 11:34:21 用户 user_25 秒杀成功
2025/07/20 11:34:21 用户 user_58 秒杀成功
2025/07/20 11:34:21 用户 user_77 秒杀成功
2025/07/20 11:34:21 用户 user_63 秒杀成功
2025/07/20 11:34:21 用户 user_15 秒杀成功
2025/07/20 11:34:21 用户 user_7 秒杀成功
2025/07/20 11:34:21 用户 user_51 秒杀成功
2025/07/20 11:34:21 用户 user_10 秒杀成功
2025/07/20 11:34:21 用户 user_33 秒杀成功
2025/07/20 11:34:21 用户 user_40 秒杀成功
2025/07/20 11:34:21 用户 user_91 秒杀成功
2025/07/20 11:34:21 用户 user_80 秒杀成功
2025/07/20 11:34:21 用户 user_11 秒杀成功
2025/07/20 11:34:21 用户 user_59 秒杀成功
2025/07/20 11:34:21 用户 user_71 秒杀成功
2025/07/20 11:34:21 用户 user_67 秒杀成功
2025/07/20 11:34:21 用户 user_19 秒杀成功
2025/07/20 11:34:21 用户 user_41 秒杀成功
2025/07/20 11:34:21 用户 user_47 秒杀成功
2025/07/20 11:34:21 用户 user_24 秒杀成功
2025/07/20 11:34:21 用户 user_30 秒杀成功
2025/07/20 11:34:21 用户 user_21 秒杀成功
2025/07/20 11:34:21 用户 user_68 秒杀成功
2025/07/20 11:34:21 用户 user_27 秒杀成功
2025/07/20 11:34:21 用户 user_82 秒杀成功
2025/07/20 11:34:21 用户 user_4 秒杀成功
2025/07/20 11:34:21 用户 user_38 秒杀成功
2025/07/20 11:34:21 用户 user_81 秒杀成功
2025/07/20 11:34:21 用户 user_88 秒杀成功
2025/07/20 11:34:21 用户 user_73 秒杀成功
2025/07/20 11:34:21 用户 user_18 秒杀成功
2025/07/20 11:34:21 用户 user_17 秒杀成功
2025/07/20 11:34:21 用户 user_20 秒杀成功
2025/07/20 11:34:21 用户 user_69 秒杀成功
2025/07/20 11:34:21 用户 user_85 秒杀成功
2025/07/20 11:34:21 用户 user_14 秒杀成功
2025/07/20 11:34:21 用户 user_26 秒杀成功
2025/07/20 11:34:21 用户 user_94 秒杀成功
2025/07/20 11:34:21 用户 user_97 秒杀成功
2025/07/20 11:34:21 用户 user_46 秒杀成功
2025/07/20 11:34:21 用户 user_36 秒杀成功
2025/07/20 11:34:21 用户 user_43 秒杀成功
2025/07/20 11:34:21 用户 user_79 秒杀成功
2025/07/20 11:34:21 用户 user_83 秒杀成功
2025/07/20 11:34:21 用户 user_23 秒杀成功
2025/07/20 11:34:21 用户 user_86 秒杀成功
2025/07/20 11:34:21 用户 user_1 秒杀成功
2025/07/20 11:34:21 用户 user_62 秒杀成功
2025/07/20 11:34:21 用户 user_57 秒杀成功
2025/07/20 11:34:21 用户 user_65 秒杀失败（库存不足）, segmentKey: stock_segment_10, stock: 0
2025/07/20 11:34:21 用户 user_65 秒杀失败（库存不足）
2025/07/20 11:34:21 用户 user_34 秒杀成功
2025/07/20 11:34:21 用户 user_90 秒杀成功
2025/07/20 11:34:21 用户 user_92 秒杀成功
2025/07/20 11:34:21 用户 user_37 秒杀成功
2025/07/20 11:34:21 用户 user_72 秒杀成功
2025/07/20 11:34:21 用户 user_54 秒杀失败（库存不足）, segmentKey: stock_segment_10, stock: 0
2025/07/20 11:34:21 用户 user_54 秒杀失败（库存不足）
2025/07/20 11:34:21 用户 user_76 秒杀失败（库存不足）, segmentKey: stock_segment_6, stock: 0
2025/07/20 11:34:21 用户 user_35 秒杀成功
2025/07/20 11:34:21 用户 user_84 秒杀成功
2025/07/20 11:34:21 用户 user_52 秒杀成功
2025/07/20 11:34:21 用户 user_76 秒杀失败（库存不足）
2025/07/20 11:34:21 用户 user_44 秒杀失败（库存不足）, segmentKey: stock_segment_10, stock: 0
2025/07/20 11:34:21 用户 user_44 秒杀失败（库存不足）
2025/07/20 11:34:21 用户 user_8 秒杀失败（库存不足）, segmentKey: stock_segment_10, stock: 0
2025/07/20 11:34:21 用户 user_8 秒杀失败（库存不足）
2025/07/20 11:34:21 用户 user_89 秒杀成功
2025/07/20 11:34:21 用户 user_50 秒杀成功
2025/07/20 11:34:21 用户 user_12 秒杀成功
2025/07/20 11:34:22 用户 user_16 秒杀失败（库存不足）, segmentKey: stock_segment_10, stock: 0
2025/07/20 11:34:22 用户 user_16 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_32 秒杀失败（库存不足）, segmentKey: stock_segment_10, stock: 0
2025/07/20 11:34:22 用户 user_32 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_66 秒杀失败（库存不足）, segmentKey: stock_segment_1, stock: 0
2025/07/20 11:34:22 用户 user_49 秒杀失败（库存不足）, segmentKey: stock_segment_10, stock: 0
2025/07/20 11:34:22 用户 user_66 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_49 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_22 秒杀失败（库存不足）, segmentKey: stock_segment_10, stock: 0
2025/07/20 11:34:22 用户 user_13 秒杀失败（库存不足）, segmentKey: stock_segment_5, stock: 0
2025/07/20 11:34:22 用户 user_22 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_13 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_6 秒杀成功
2025/07/20 11:34:22 用户 user_60 秒杀失败（库存不足）, segmentKey: stock_segment_1, stock: 0
2025/07/20 11:34:22 用户 user_93 秒杀失败（库存不足）, segmentKey: stock_segment_10, stock: 0
2025/07/20 11:34:22 用户 user_60 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_93 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_13 秒杀失败（库存不足）, segmentKey: stock_segment_5, stock: 0
2025/07/20 11:34:22 用户 user_22 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_13 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_6 秒杀成功
2025/07/20 11:34:22 用户 user_60 秒杀失败（库存不足）, segmentKey: stock_segment_1, stock: 0
2025/07/20 11:34:22 用户 user_93 秒杀失败（库存不足）, segmentKey: stock_segment_10, stock: 0
2025/07/20 11:34:22 用户 user_60 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_93 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_13 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_6 秒杀成功
2025/07/20 11:34:22 用户 user_60 秒杀失败（库存不足）, segmentKey: stock_segment_1, stock: 0
2025/07/20 11:34:22 用户 user_93 秒杀失败（库存不足）, segmentKey: stock_segment_10, stock: 0
2025/07/20 11:34:22 用户 user_60 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_93 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_93 秒杀失败（库存不足）, segmentKey: stock_segment_10, stock: 0
2025/07/20 11:34:22 用户 user_60 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_93 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_93 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_29 秒杀失败（库存不足）, segmentKey: stock_segment_10, stock: 0
2025/07/20 11:34:22 用户 user_29 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_55 秒杀失败（库存不足）, segmentKey: stock_segment_1, stock: 0
2025/07/20 11:34:22 用户 user_55 秒杀失败（库存不足）
2025/07/20 11:34:22 用户 user_31 秒杀失败（库存不足）, segmentKey: stock_segment_10, stock: 0
2025/07/20 11:34:22 用户 user_31 秒杀失败（库存不足）
2025/07/20 11:34:22 秒杀结果: 成功 84 次, 失败 16 次
2025/07/20 11:34:22 剩余总库存: 16


# 全局库存调拨还是可能会出现热点不均， 可以考虑分段之间库存转移？